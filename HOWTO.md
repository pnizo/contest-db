# FWJコンテストDB 使い方ガイド

タスク別・ステップバイステップの操作手順

## 目次

- [FWJコンテストDB 使い方ガイド](#fwjコンテストdb-使い方ガイド)
  - [目次](#目次)
  - [1. コンテスト情報(Contestsテーブル)に年間の大会基本情報を入力しておく](#1-コンテスト情報contestsテーブルに年間の大会基本情報を入力しておく)
    - [大会基本情報を登録するには](#大会基本情報を登録するには)
  - [2. 大会の準備をする](#2-大会の準備をする)
    - [Shopifyから出場登録データを取り込む](#shopifyから出場登録データを取り込む)
    - [開催順CSVをインポートして出場順を設定する](#開催順csvをインポートして出場順を設定する)
    - [ゼッケン番号を採番する](#ゼッケン番号を採番する)
    - [出場登録データをCSVで出力するには](#出場登録データをcsvで出力するには)
    - [全項目CSVデータをインポートするには](#全項目csvデータをインポートするには)
  - [3. 大会当日の運営](#3-大会当日の運営)
    - [特記事項を記録するには（欠席・クラス変更など）](#特記事項を記録するには欠席クラス変更など)
    - [チケットのチェックインを行うには](#チケットのチェックインを行うには)
    - [関係者チケットを管理するには](#関係者チケットを管理するには)
  - [4. 大会後の処理](#4-大会後の処理)
    - [大会成績をインポートするには](#大会成績をインポートするには)
  - [5. チケット管理](#5-チケット管理)
    - [Shopifyからチケットをインポートするには](#shopifyからチケットをインポートするには)
    - [指定席を割り当てるには（指定席CSV）](#指定席を割り当てるには指定席csv)
    - [商品名別にCSVを出力するには](#商品名別にcsvを出力するには)
  - [5. Shopifyデータの検索](#5-shopifyデータの検索)
    - [FWJ会員を検索するには](#fwj会員を検索するには)
    - [注文をタグで検索するには](#注文をタグで検索するには)
  - [6. ユーザー管理](#6-ユーザー管理)
    - [新しいユーザーを追加するには（管理者のみ）](#新しいユーザーを追加するには管理者のみ)
    - [パスワードを変更するには](#パスワードを変更するには)

---

## 1. コンテスト情報(Contestsテーブル)に年間の大会基本情報を入力しておく

### 大会基本情報を登録するには

1. ナビゲーションバーの「大会運営」→「大会基本情報」をクリック
2. 「新規追加」ボタンをクリック
3. 以下の情報を入力：
   - **大会名**（必須）: 大会の正式名称
   - **開催日**: 大会の日付
   - **開催地**: 会場名・住所（現在使われていないので未入力でも可）
   - **公開設定（isReady）**: 出場登録の情報が確定したらチェックする。チェックすると、ゼッケン番号がFWJアプリの「出場登録」画面に表示されるようになる。
   - **テスト大会（isTest）**: テスト用データの場合はチェック。チェックすると一般ユーザーのアプリ画面には大会情報が表示されなくなる。
4. 「保存」ボタンをクリック

> **ポイント**: 公開設定（isReady）を変更するとFWJアプリのキャッシュが自動的にクリアされます。

## 2. 大会の準備をする

1. Shopifyからエントリーデータを同期する
2. 開催順CSVを読み込んで開催順 / スコアカード番号をセットする
3. 必要に応じて、全項目CSVのエクスポート→インポートで登録情報の修正と追加を行う
4. 登録情報が完成したら、全項目CSVをエクスポートして、Registrations作成シートに読み込ませる
5. ゼッケン番号用CSVをエクスポートして、FWJ HPのゼッケン番号ページに読み込ませる

### Shopifyから出場登録データを取り込む

基本的にはエントリー受付終了後に行うこと

1. ナビゲーションバーの「大会運営」→「出場登録」をクリック
2. 「データ追加」→「Shopify同期」をクリック
3. インポートモーダルが表示されたら、以下を順番に実行：
   1. コンテストを選択する
   2. 「インポート実行」をクリック → 出場登録データ(Registrations)のひな型を生成する
4. インポート結果（件数、新規/更新など）を確認

> **ポイント**: 既存の選手番号（player_no）は引き継がれます。新規登録分にのみ新しい番号が発行されます。

### 開催順CSVをインポートして出場順を設定する

1. ナビゲーションバーの「大会運営」→「出場登録」をクリック
2. 「データ採番」→「開催順CSV適用」をクリック
3. 対象の大会名をドロップダウンから選択
4. CSVファイルを選択
   - 必須列: `class_name`, `score_card`, `contest_order`
5. 「インポート実行」をクリック

### ゼッケン番号を採番する

1. ナビゲーションバーの「大会運営」→「出場登録」をクリック
2. 「データ採番」→「ゼッケン採番」をクリック
3. 対象の大会名をドロップダウンから選択
4. 採番モードを選択
   - 通常は「既存番号を残す（未裁判のみ付与）」でOK
5. 「採番実行」をクリック

### 出場登録データをCSVで出力するには

1. ナビゲーションバーの「大会運営」→「出場登録」をクリック
2. 「CSV出力」ボタンをクリック
3. 対象の大会をドロップダウンから選択
4. リストの種類を選択：
   - **選手番号（ゼッケン表示用）**: 出場順のリスト
   - **全項目**: すべてのフィールドを含むCSV
5. CSVファイルが自動的にダウンロードされます

### 全項目CSVデータをインポートするには

1. ナビゲーションバーの「大会運営」→「出場登録」をクリック
2. 「全項目CSVを適用」ボタンをクリック
3. CSVファイルを指定する
4. インポートする項目をチェックする
5. 「インポート実行」ボタンをクリック

---

## 3. 大会当日の運営

### 特記事項を記録するには（欠席・クラス変更など）

1. ナビゲーションバーの「大会運営」→「特記事項」をクリック
2. 「新規追加」ボタンをクリック
3. 以下の情報を入力：
   - **コンテスト名**（必須）: ドロップダウンから選択
   - **ゼッケン番号** または **FWJカード番号**
   - **氏名**（必須）
   - **登録内容**: 「欠席」「クラス変更」「チェックイン時刻変更」「当日クラス追加」「FWJカード現地支払」「帰宅」「その他」から選択
   - **詳細メモ**: 具体的な内容を記載
4. 選手情報を自動入力したい場合は「出場登録データから検索して自動入力」をクリック
5. 「保存」ボタンをクリック

### チケットのチェックインを行うには

1. チェックイン専用ページ（`https://ticket-checkin.fwj.jp/checkin`）にアクセス
2. チェックインコード（XXXX-XXXX-XXXX形式）を入力
   - 入力は自動的に大文字化・フォーマットされます
3. チケット情報が表示されるので内容を確認：
   - 注文番号、商品名、座席情報
   - ステータス: 「使用可能」（緑）または「使用済み」（赤）
4. 「使用可能」の場合、「チェックイン実行」ボタンをクリック
5. チェック結果（成功/エラー）を確認
6. 次のチケットを処理する場合は「リセット」をクリック

### 関係者チケットを管理するには

1. ナビゲーションバーの「入場管理」→「関係者チケット」をクリック
2. 「新規追加」ボタンをクリック
3. 以下の情報を入力：
   - **大会名**: ドロップダウンから選択（開催日は自動入力）
   - **チケット種別**: 関係者席、前売VVIP席 などから選択
   - **団体/個人**: 選択
   - **付与パス**: 関係者パス、撮影者パス などから選択
   - **代表者氏名**（必須）
   - **団体名**: 企業名・団体名
   - **申請種別**: メディア、出展者、招待、その他
   - **合計付与枚数**
   - **備考欄**: 同伴者氏名など
4. 「保存」ボタンをクリック

当日のチェックインは、一覧テーブルの「Check-In」チェックボックスで管理できます。

---

## 4. 大会後の処理

### 大会成績をインポートするには

1. ナビゲーションバーの「大会運営」→「大会成績」をクリック
2. 「インポート」ボタンをクリック
3. 対象の大会をドロップダウンから選択
4. CSVファイルを選択（NPC Worldwide Results形式）
5. 「CSVをインポート」ボタンをクリック
6. インポート結果を確認
   - フォールバック件数の警告が表示された場合は、該当選手の情報を確認してください

> **ポイント**: インポート時に選手番号（player_no）とカテゴリーで出場登録データを自動的にルックアップします。完全一致しない場合は他クラスでフォールバック検索します。



---

## 5. チケット管理

### Shopifyからチケットをインポートするには

1. ナビゲーションバーの「入場管理」→「チケット管理」をクリック
2. 「Shopify同期」ボタンをクリック
3. インポートモーダルで以下を設定：
   - **タグ**: 検索タグ（デフォルト：「観戦チケット」）
   - **取得期間**: 何ヶ月前からの注文を取得するか（デフォルト：3ヶ月）
4. 「インポート実行」ボタンをクリック
5. インポート結果（新規/更新件数）を確認

> **ポイント**: 既に使用済み（チェックイン済み）のチケットはインポート時に保護され、上書きされません。

### 指定席を割り当てるには（指定席CSV）

1. ナビゲーションバーの「入場管理」→「チケット管理」をクリック
2. 「指定席CSVを適用」ボタンをクリック
3. CSVファイルを選択
   - 必須列: `id`, `reserved_seat`
4. 指定席番号が一括更新されます

### 商品名別にCSVを出力するには

1. ナビゲーションバーの「入場管理」→「チケット管理」をクリック
2. 「CSV出力」ボタンをクリック
3. 出力対象の商品名をドロップダウンから選択
4. CSVファイルが自動的にダウンロードされます

---

## 5. Shopifyデータの検索

### FWJ会員を検索するには

1. ナビゲーションバーの「ユーティリティ」→「FWJ会員検索」をクリック
2. 検索ボックスに以下のいずれかを入力：
   - メールアドレス
   - 氏名（日本語・英語）
   - Shopify ID
   - FWJカード番号
3. 検索結果から該当する会員を確認

> **ポイント**: 会員データを最新にするには、「Shopifyから同期」ボタンをクリックしてください（管理者のみ）。「FWJカード会員」タグが付いている会員のみ同期されます。

### 注文をタグで検索するには

1. ナビゲーションバーの「ユーティリティ」→「注文検索」をクリック
2. 「注文タグ」欄に検索したいタグを入力
   - 複数タグはスペース区切りでAND検索
   - スペースを含むタグは引用符で囲む（例: `"タグ名 スペース付き"`）
3. 必要に応じて「支払済の注文のみ検索する」にチェック
4. 「検索」ボタンをクリック
5. 検索結果が表示されます（商品名、支払いステータスなどでフィルタ可能）

---

## 6. ユーザー管理

コンテストDBを使用するユーザーの追加、編集、削除ができます。

### 新しいユーザーを追加するには（管理者のみ）

1. ナビゲーションバーの「ユーザー」をクリック
2. 「新規ユーザー追加」ボタンをクリック
3. 以下の情報を入力：
   - **ユーザー名**
   - **メールアドレス**（一意である必要があります）
   - **パスワード**
   - **権限**: admin（管理者）/ user（一般ユーザー）/ guest（ゲスト）から選択
4. 「追加」ボタンをクリック

> **ポイント**: 削除済みユーザーと同じメールアドレスで追加すると、自動的に既存のユーザーが復元されます。

### パスワードを変更するには

1. ナビゲーションバーの「ユーザー」をクリック
2. 対象ユーザーの「編集」ボタンをクリック
3. 新しいパスワードを入力
4. 「更新」ボタンをクリック

> **注意**: ゲストユーザーはパスワード変更ができません。

---

**Document Version**: 1.0
**Last Updated**: 2026年2月9日

各機能の詳細仕様は [機能一覧マニュアル（manual.html）](public/manual.html) を参照してください。
