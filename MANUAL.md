# Spreadsheet DB ユーザーマニュアル

## 目次
1. [システム概要](#システム概要)
2. [ログイン](#ログイン)
3. [ユーザー管理](#ユーザー管理)
4. [大会成績管理](#大会成績管理)
5. [出場登録管理](#出場登録管理)
6. [特記事項管理](#特記事項管理)
7. [関係者チケット管理](#関係者チケット管理)
8. [大会情報管理](#大会情報管理)
9. [FWJ会員情報](#fwj会員情報)
10. [違反認定者管理](#違反認定者管理)
11. [権限について](#権限について)

---

## システム概要

### 概要
Spreadsheet DBは、Google Spreadsheetをデータベースとして使用するコンテスト成績管理システムです。フィットネス・ボディビル大会の選手情報、成績、出場登録、関係者情報などを一元管理できます。

### 主な機能
- **認証システム**：JWT（JSON Web Token）を使用した安全なログイン認証
- **ロールベースアクセス制御**：管理者と一般ユーザーで権限を分離
- **リアルタイム同期**：Google Sheets APIを使用した即時データ同期
- **CSVインポート/エクスポート**：大量データの一括処理
- **論理削除**：データを物理的に削除せず、復元可能な状態で管理
- **検索・フィルタリング**：各種条件でのデータ絞り込み

### システムアーキテクチャ
- **フロントエンド**：HTML + JavaScript（バニラJS）
- **バックエンド**：Node.js + Express
- **データベース**：Google Spreadsheet
- **認証**：JWT + bcrypt（パスワードハッシュ化）
- **デプロイ**：Vercel対応

---

## ログイン

### ページ概要
システムの入り口となるログインページです。メールアドレスとパスワードで認証を行います。

### アクセス方法
- URL: `/` （ルートパス）

### 使い方

#### 1. ログイン手順
1. メールアドレスを入力
2. パスワードを入力
3. 「ログイン」ボタンをクリック

#### 2. ログイン後の動作
- 認証成功時：JWTトークンがローカルストレージに保存され、自動的にユーザー一覧ページにリダイレクト
- 認証失敗時：エラーメッセージを表示

### セキュリティ機能
- パスワードは bcrypt でハッシュ化されて保存
- JWT トークンは24時間有効
- IP制限機能（管理者が設定可能）

---

## ユーザー管理

### ページ概要
システムにアクセスするユーザーアカウントを管理するページです。管理者権限を持つユーザーのみが新規作成・編集・削除を実行できます。

### アクセス方法
- URL: `/users`
- ナビゲーションバー：「ユーザー」リンク

### 主な機能

#### 1. ユーザー一覧表示
- **表示項目**：
  - ユーザー名
  - メールアドレス
  - 権限（admin / user）
  - 作成日時
  - 更新日時
  - 状態（有効 / 削除済み）

#### 2. 新規ユーザー追加（管理者のみ）
1. 「新規ユーザー追加」ボタンをクリック
2. 以下の情報を入力：
   - ユーザー名
   - メールアドレス（一意である必要があります）
   - パスワード
   - 権限（admin / user）
3. 「追加」ボタンをクリック

#### 3. ユーザー編集（管理者のみ）
1. 編集したいユーザーの「編集」ボタンをクリック
2. 情報を修正
3. 「更新」ボタンをクリック

#### 4. ユーザー削除（管理者のみ）
1. 削除したいユーザーの「削除」ボタンをクリック
2. 確認ダイアログで「OK」をクリック
3. ユーザーは論理削除され、`isValid`フラグが`false`に設定されます

#### 5. 削除済みユーザーの管理
- **削除済み表示**: 「削除済みを表示」ボタンで削除済みユーザーの表示/非表示を切り替え
- **復元**: 削除済みユーザーの「復元」ボタンをクリック
- **完全削除**: 削除済みユーザーの「完全削除」ボタンで物理削除（復元不可）

#### 6. 自動復元機能
削除済みユーザーと同じメールアドレスで新規ユーザーを作成すると、自動的に既存のユーザーが復元されます。

### 一般ユーザーの制限
- ユーザー一覧の閲覧のみ可能
- 作成・編集・削除ボタンは非表示

---

## 大会成績管理

### ページ概要
フィットネス・ボディビル大会の選手成績を管理するページです。CSVファイルからの一括インポートに対応しています。

### アクセス方法
- URL: `/scores`
- ナビゲーションバー：「大会成績」リンク

### 主な機能

#### 1. 成績一覧表示
- **表示項目**：
  - FWJカード番号
  - 大会日
  - 大会名
  - カテゴリー名
  - 選手名
  - 順位
  - エントリー数
  - ポイント
  - 状態（有効 / 削除済み）

#### 2. CSVインポート（認証済みユーザー）
1. 「インポート」ボタンをクリック
2. CSVファイルを選択（ドラッグ&ドロップも可）
3. プレビューでデータを確認
4. 「インポート開始」ボタンをクリック

**CSVファイル形式**：
```csv
fwj_card_no,contest_date,contest_name,category,athlete_name,rank,entry_count,points
12345,2025-01-15,サンプル大会,メンズフィジーク,山田太郎,1,10,100
```

#### 3. 検索機能
- 検索ボックスに選手名を入力
- リアルタイムで結果を絞り込み
- 「検索をクリア」ボタンで検索条件をリセット

#### 4. フィルタリング機能
- **FWJカード番号**: 特定のカード番号で絞り込み
- **大会名**: ドロップダウンから選択
- **カテゴリー名**: ドロップダウンから選択
- **期間指定**: 開始日と終了日で絞り込み

#### 5. 成績削除（管理者のみ）
- 論理削除方式で削除
- 削除済み成績の表示/非表示切り替え可能
- 削除済み成績の復元機能

### データ管理のポイント
- 大量データの場合は CSVインポートを推奨
- Google Sheets APIの`spreadsheets.values.append`を使用した高速バッチ処理
- インポート中は進行状況を表示

---

## 出場登録管理

### ページ概要
大会への出場登録情報を管理するページです。選手のエントリー情報を一元管理できます。

### アクセス方法
- URL: `/registrations`
- ナビゲーションバー：「出場登録」リンク

### 主な機能

#### 1. 登録一覧表示
- **表示項目**：
  - 氏名（漢字・カナ・ローマ字）
  - 大会名
  - カテゴリー
  - FWJカード番号
  - エントリー番号
  - 出場順序
  - 登録日時
  - 状態

#### 2. CSVインポート
1. 「インポート」ボタンをクリック
2. CSVファイルを選択
3. データプレビューで確認
4. インポート実行

#### 3. CSVエクスポート
1. 「エクスポート」ボタンをクリック
2. エクスポート条件を指定（オプション）
3. CSVファイルとしてダウンロード

#### 4. 検索機能
- 氏名（漢字・カナ・ローマ字）で検索
- リアルタイム検索対応
- 部分一致検索

#### 5. データ編集（管理者のみ）
- 個別レコードの編集
- 一括更新
- 論理削除と復元

### 入力項目詳細
- **氏名**: 漢字、カナ、ローマ字の3形式
- **FWJカード番号**: 選手識別番号
- **大会情報**: 大会名、カテゴリー
- **エントリー情報**: エントリー番号、出場順序
- **連絡先**: メールアドレス、電話番号（任意）

---

## 特記事項管理

### ページ概要
選手に関する特記事項や注意事項を記録・管理するページです。違反事項、健康状態、特別対応などの情報を管理できます。

### アクセス方法
- URL: `/notes`
- ナビゲーションバー：「特記事項」リンク

### 主な機能

#### 1. 特記事項一覧表示
- **表示項目**：
  - 氏名
  - FWJカード番号
  - 特記事項の内容
  - カテゴリー（違反、健康、その他など）
  - 記録日時
  - 更新日時

#### 2. 新規追加
1. 「新規追加」ボタンをクリック
2. 以下の情報を入力：
   - 氏名
   - FWJカード番号
   - 特記事項の内容
   - カテゴリー選択
3. 「追加」ボタンをクリック

#### 3. 編集・削除（管理者のみ）
- 編集：該当レコードの「編集」ボタンから
- 削除：論理削除方式
- 復元：削除済み特記事項の復元可能

#### 4. 検索機能
- 氏名で検索
- FWJカード番号で検索
- 特記事項の内容で検索

### 利用シーン
- アンチドーピング違反の記録
- 健康上の注意事項
- 特別な配慮が必要な事項
- 過去のトラブル記録

---

## 関係者チケット管理

### ページ概要
大会関係者のチケット配布・管理を行うページです。選手のサポート関係者、スタッフ、メディアなどのチケット情報を管理できます。

### アクセス方法
- URL: `/guests`
- ナビゲーションバー：「関係者チケット」リンク

### 主な機能

#### 1. チケット一覧表示
- **表示項目**：
  - 代表者氏名
  - 団体名
  - 関係種別（コーチ、家族、メディアなど）
  - チケット枚数
  - 大会名
  - 発行日
  - ステータス（発行済み、使用済み、キャンセルなど）

#### 2. 新規追加
1. 「新規追加」ボタンをクリック
2. 以下の情報を入力：
   - 代表者氏名
   - 団体名（任意）
   - 関係種別
   - チケット枚数
   - 対象大会
   - 備考（任意）
3. 「追加」ボタンをクリック

#### 3. フィルタリング
- **大会名**: ドロップダウンから選択
- **関係種別**: コーチ、家族、メディア、スポンサーなど
- **ステータス**: 発行済み、使用済み、キャンセル

#### 4. 検索機能
- 代表者氏名で検索
- 団体名で検索
- 複合検索対応

#### 5. ステータス管理
- チケット発行
- 使用済みに変更
- キャンセル処理
- 再発行

### チケット種別
- **選手サポート**: コーチ、トレーナー、家族
- **メディア**: 取材関係者、撮影スタッフ
- **スポンサー**: 協賛企業関係者
- **運営スタッフ**: 大会運営メンバー
- **VIP**: 特別招待者

---

## 大会情報管理

### ページ概要
大会の基本情報を管理するページです。開催日程、会場、カテゴリーなどの情報を登録・管理できます。

### アクセス方法
- URL: `/contests`
- ナビゲーションバー：「大会情報」リンク

### 主な機能

#### 1. 大会一覧表示
- **表示項目**：
  - 大会名
  - 開催日
  - 開催地
  - 会場名
  - カテゴリー
  - エントリー状況
  - ステータス（予定、開催中、終了）

#### 2. 新規大会追加（管理者のみ）
1. 「新規追加」ボタンをクリック
2. 以下の情報を入力：
   - 大会名
   - 開催日
   - 開催地（都道府県、市区町村）
   - 会場名
   - カテゴリー情報
   - エントリー期間
   - 大会詳細
3. 「追加」ボタンをクリック

#### 3. 検索・フィルタリング
- **検索**: 大会名、開催地で検索
- **期間フィルター**: 開始日〜終了日で絞り込み
- **ステータスフィルター**: 予定、開催中、終了
- **カテゴリーフィルター**: メンズフィジーク、ビキニなど

#### 4. 大会情報編集（管理者のみ）
- 基本情報の編集
- カテゴリーの追加・削除
- エントリー期間の変更
- ステータスの更新

#### 5. 大会管理機能
- エントリー状況の確認
- 関連する成績データへのリンク
- 出場登録データへのリンク
- 大会レポートのエクスポート

### 大会ステータス
- **予定**: これから開催される大会
- **エントリー受付中**: 出場登録可能
- **エントリー締切**: 登録受付終了
- **開催中**: 現在進行中
- **終了**: 成績確定済み

---

## FWJ会員情報

### ページ概要
FWJ（Fitness World Japan）の会員情報を管理するページです。Shopifyと連携して会員データを同期できます。

### アクセス方法
- URL: `/members`
- ナビゲーションバー：「FWJ会員情報」リンク

### 主な機能

#### 1. 会員一覧表示
- **表示項目**：
  - FWJカード番号
  - 氏名（漢字・カナ）
  - メールアドレス
  - 電話番号
  - 会員種別（レギュラー、プロ、ライフタイムなど）
  - 会員ステータス（有効、期限切れ）
  - 登録日
  - 有効期限

#### 2. Shopify同期（管理者のみ）
1. 「Shopifyから同期」ボタンをクリック
2. Shopify APIから最新の会員データを取得
3. 差分を自動判定して更新
4. 同期結果レポートを表示

**同期される情報**：
- 会員基本情報
- 購入履歴（会員資格）
- 有効期限
- メタデータ

#### 3. 検索機能
- メールアドレスで検索
- 氏名（漢字・カナ）で検索
- FWJカード番号で検索

#### 4. フィルタリング
- **会員種別**: レギュラー、プロ、ライフタイムなど
- **ステータス**: 有効、期限切れ、停止中
- **登録期間**: 指定期間内の新規登録者

#### 5. 会員情報編集（管理者のみ）
- 基本情報の修正
- 会員種別の変更
- 有効期限の延長
- メモの追加

### Shopify連携について
- **自動同期**: 定期的な自動同期（管理者設定）
- **手動同期**: 必要に応じて即時同期
- **データマッピング**: Shopify商品とFWJ会員種別の対応
- **エラーハンドリング**: 同期エラーの記録と通知

### 注意事項
- Shopifyとの連携にはAPIキーの設定が必要
- 初回同期時は全データの取得に時間がかかる場合があります
- 会員データの直接編集はShopifyデータに上書きされる可能性があります

---

## 違反認定者管理

### ページ概要
アンチドーピング違反やその他の規約違反を認定された選手を管理するページです。**管理者のみがアクセスできる機密情報**を扱います。

### アクセス方法
- URL: `/subjects`
- ナビゲーションバー：「違反認定者」リンク（管理者のみ表示）

### 主な機能

#### 1. 違反認定者一覧表示
- **表示項目**：
  - 氏名
  - FWJカード番号
  - 違反種別（ドーピング、不正行為など）
  - 違反内容詳細
  - 認定日
  - 制裁期間
  - ステータス（制裁中、制裁終了）
  - 関連資料

#### 2. 新規認定者追加（管理者のみ）
1. 「新規認定者追加」ボタンをクリック
2. 以下の情報を入力：
   - 氏名
   - FWJカード番号
   - 違反種別
   - 違反内容の詳細
   - 認定日
   - 制裁内容
   - 制裁期間（開始日〜終了日）
   - 備考・関連情報
3. 「追加」ボタンをクリック

#### 3. 検索機能
- 氏名で検索
- FWJカード番号で検索
- 違反種別で絞り込み

#### 4. ステータス管理
- **制裁中**: 現在制裁期間中
- **制裁終了**: 制裁期間が終了
- **審査中**: 違反認定の審査中
- **却下**: 違反認定が却下された

#### 5. 削除と復元
- 論理削除方式
- 「削除済みを表示」で削除済みデータの確認
- 必要に応じて復元可能

### 違反種別
- **ドーピング違反**: アンチドーピング規約違反
- **不正行為**: 審査における不正行為
- **暴力行為**: 暴力やハラスメント
- **規約違反**: その他の規約違反
- **資格詐称**: 虚偽の情報による登録

### セキュリティとプライバシー
- **アクセス制限**: 管理者のみアクセス可能
- **機密情報**: 個人情報保護法に基づいた厳重管理
- **監査ログ**: 全ての閲覧・編集操作を記録
- **データ暗号化**: 機密データの暗号化保存

---

## 権限について

### ユーザー権限の種類

#### 管理者（Admin）
**全機能の利用が可能**：
- ✅ 全ページへのアクセス
- ✅ データの作成（Create）
- ✅ データの読み取り（Read）
- ✅ データの更新（Update）
- ✅ データの削除（Delete）
- ✅ CSVインポート/エクスポート
- ✅ 削除済みデータの復元・完全削除
- ✅ ユーザー管理
- ✅ 違反認定者情報へのアクセス
- ✅ Shopify同期機能

#### 一般ユーザー（User）
**閲覧とCSVインポートのみ可能**：
- ✅ 全ページへのアクセス（違反認定者ページを除く）
- ✅ データの読み取り（Read）
- ✅ CSVインポート（大会成績、出場登録）
- ✅ 検索・フィルタリング
- ❌ データの作成・更新・削除
- ❌ ユーザー管理
- ❌ 削除済みデータの復元
- ❌ 違反認定者情報へのアクセス
- ❌ Shopify同期機能

### 権限による表示制御
- 一般ユーザーがアクセスした場合、作成・編集・削除ボタンは自動的に非表示
- 「違反認定者」ナビゲーションリンクは管理者にのみ表示
- 管理者専用機能には `.admin-only` クラスが付与され、CSS で制御

---

## よくある質問（FAQ）

### Q1: パスワードを忘れた場合は？
A: 現在、管理者に連絡してパスワードリセットを依頼してください。将来的にパスワードリセット機能の追加を予定しています。

### Q2: CSVインポートでエラーが出る
A: 以下を確認してください：
- CSVファイルの文字コードが UTF-8 であること
- ヘッダー行が正しい形式であること
- 必須項目が全て入力されていること
- 日付形式が `YYYY-MM-DD` であること

### Q3: 削除したデータは復元できますか？
A: はい。論理削除方式を採用しているため、管理者は削除済みデータを復元できます。ただし、「完全削除」を実行した場合は復元できません。

### Q4: スマートフォンでも使えますか？
A: はい。レスポンシブデザインを採用しており、スマートフォンやタブレットでも利用できます。

### Q5: データのバックアップは？
A: Google Spreadsheet上にデータが保存されているため、Google の自動バックアップ機能が有効です。また、定期的な CSV エクスポートをお勧めします。

### Q6: 複数のユーザーが同時に編集できますか？
A: はい。ただし、同じレコードを同時に編集した場合、最後に保存した内容が反映されます（Last Write Wins）。

---

## トラブルシューティング

### ログインできない
- メールアドレスとパスワードが正しいか確認
- ブラウザのキャッシュをクリア
- JWT トークンの有効期限切れの可能性（再ログイン）

### データが表示されない
- インターネット接続を確認
- Google Sheets API の接続状態を確認
- ブラウザのコンソールでエラーログを確認
- ページをリロード

### CSVインポートが失敗する
- ファイルサイズが大きすぎる（50MB制限）
- CSV形式が正しいか確認
- ネットワークの安定性を確認

### 権限エラーが表示される
- 自分のユーザー権限を確認
- 管理者のみの機能にアクセスしていないか確認
- セッションの有効期限切れ（再ログイン）

---

## システム要件

### ブラウザ
- Google Chrome（推奨）
- Firefox
- Safari
- Microsoft Edge

### ネットワーク
- インターネット接続必須
- Google Sheets API へのアクセス権限

### 推奨環境
- 画面解像度: 1280x720 以上
- 安定したインターネット接続
- 最新版ブラウザの使用

---

## サポート情報

### 技術サポート
問題が解決しない場合は、システム管理者に連絡してください。

### フィードバック
機能改善のご要望やバグ報告は、開発チームまでお知らせください。

### バージョン情報
- システムバージョン: 1.0.0
- 最終更新日: 2026年1月

---

## まとめ

Spreadsheet DB は、Google Spreadsheet を活用した強力なコンテスト管理システムです。権限管理、論理削除、CSVインポートなど、実務に必要な機能を網羅しています。

本マニュアルに記載されていない内容や、使い方で不明な点がある場合は、システム管理者にお問い合わせください。

---

**Document Version**: 1.0  
**Last Updated**: 2026年1月9日
