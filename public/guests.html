<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>関係者チケット - スプレッドシートDB</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div id="authHeader" class="auth-header" style="display: none;">
            <div class="user-info-display">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-details-display">
                    <div class="name" id="userName"></div>
                    <div class="role" id="userRole"></div>
                </div>
            </div>
            <div class="auth-actions">
                <nav class="page-nav">
                    <a href="/users" class="nav-link">ユーザー</a>

                    <div class="nav-dropdown">
                        <button class="nav-link dropdown-toggle">大会運営 <span class="dropdown-arrow">▼</span></button>
                        <div class="dropdown-menu">
                            <a href="/contests" class="dropdown-item">コンテスト情報</a>
                            <a href="/registrations" class="dropdown-item">出場登録</a>
                            <a href="/scores" class="dropdown-item">大会成績</a>
                            <a href="/notes" class="dropdown-item">特記事項</a>
                            <a href="/subjects" class="dropdown-item admin-only">違反認定者</a>
                        </div>
                    </div>

                    <div class="nav-dropdown">
                        <button class="nav-link dropdown-toggle active">入場管理 <span class="dropdown-arrow">▼</span></button>
                        <div class="dropdown-menu">
                            <a href="/guests" class="dropdown-item active">関係者チケット</a>
                            <a href="/tickets" class="dropdown-item">チケット管理</a>
                            <a href="/members" class="dropdown-item">FWJ会員情報</a>
                            <a href="/orders" class="dropdown-item">注文検索</a>
                        </div>
                    </div>
                </nav>
                <a href="/manual.html" target="_blank" class="manual-link">マニュアル</a>
                <button id="logoutBtn" class="logout-btn">ログアウト</button>
            </div>
        </div>

        <main class="guests-main">
            <section class="guests-section">
                <h2>関係者チケット</h2>
                <div class="section-controls">
                    <div class="controls">
                        <div class="search-container">
                            <div class="search-input-wrapper">
                                <input type="text" id="searchInput" placeholder="代表者氏名、団体名で検索..." class="search-input">
                                <button type="button" id="clearSearchBtn" class="clear-btn hidden" title="検索をクリア">×</button>
                            </div>
                            <button type="button" id="searchBtn" class="search-btn" title="検索">検索</button>
                        </div>
                        <button type="button" id="addNewBtn" class="action-btn primary">新規追加</button>
                    </div>
                </div>
                <div class="filters">
                    <div class="filter-row">
                        <select id="contestFilter" class="filter-select">
                            <option value="">大会名を選択</option>
                        </select>
                        <select id="organizationTypeFilter" class="filter-select">
                            <option value="">団体/個人を選択</option>
                        </select>
                        <select id="passTypeFilter" class="filter-select">
                            <option value="">付与パスを選択</option>
                        </select>
                    </div>
                    <div class="filter-row">
                        <div class="filter-actions">
                            <button id="applyFiltersBtn" class="filter-btn">絞り込み</button>
                            <button id="clearFiltersBtn" class="filter-btn">クリア</button>
                        </div>
                    </div>
                </div>

                <div id="guestsTableContainer" class="table-scroll-container">
                    <div class="loading">読み込み中...</div>
                </div>

                <div id="pagination" class="pagination hidden">
                    <button id="prevPageBtn" class="pagination-btn">前へ</button>
                    <span id="pageInfo" class="page-info">ページ 1 / 1 (全 0 件)</span>
                    <button id="nextPageBtn" class="pagination-btn">次へ</button>
                </div>
            </section>
        </main>

        <div id="notification" class="notification hidden"></div>
    </div>

    <!-- 編集/新規追加ダイアログ -->
    <div id="editDialog" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="editDialogTitle">関係者チケットを編集</h3>
                <button type="button" class="modal-close" id="closeEditDialog">&times;</button>
            </div>
            <form id="editForm">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="edit_contest_date">開催日</label>
                            <input type="date" id="edit_contest_date" name="contest_date" readonly style="background-color: #f0f0f0; cursor: not-allowed;">
                        </div>
                        <div class="form-group">
                            <label for="edit_contest_name">大会名</label>
                            <select id="edit_contest_name" name="contest_name" class="filter-select">
                                <option value="">大会名を選択</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit_ticket_type">チケット種別</label>
                            <select id="edit_ticket_type" name="ticket_type" class="filter-select">
                                <option value="">選択してください</option>
                                <option value="関係者席">関係者席</option>
                                <option value="前売VVIP席">前売VVIP席</option>
                                <option value="前売VIP席">前売VIP席</option>
                                <option value="前売S席">前売S席</option>
                                <option value="前売A席">前売A席</option>
                                <option value="前売B席">前売B席</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit_group_type">団体/個人</label>
                            <select id="edit_group_type" name="group_type" class="filter-select">
                                <option value="">選択してください</option>
                                <option value="IFBB PRO">IFBB PRO</option>
                                <option value="団体">団体</option>
                                <option value="個人">個人</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit_pass_type">付与パス</label>
                            <select id="edit_pass_type" name="pass_type" class="filter-select">
                                <option value="">選択してください</option>
                                <option value="関係者パス">関係者パス</option>
                                <option value="IFBB Proパス">IFBB Proパス</option>
                                <option value="撮影者パス">撮影者パス</option>
                                <option value="出展者パス">出展者パス</option>
                                <option value="GUESTパス">GUESTパス</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit_name_ja">代表者氏名 <span class="required">*</span></label>
                            <input type="text" id="edit_name_ja" name="name_ja" required>
                        </div>
                        <div class="form-group">
                            <label for="edit_company_ja">団体名（企業名）</label>
                            <input type="text" id="edit_company_ja" name="company_ja">
                        </div>
                        <div class="form-group">
                            <label for="edit_email">連絡先メールアドレス</label>
                            <input type="email" id="edit_email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="edit_phone">緊急電話番号</label>
                            <input type="tel" id="edit_phone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="edit_contact_person">社内担当者名</label>
                            <input type="text" id="edit_contact_person" name="contact_person">
                        </div>
                        <div class="form-group">
                            <label for="edit_request_type">申請種別</label>
                            <select id="edit_request_type" name="request_type" class="filter-select">
                                <option value="">選択してください</option>
                                <option value="IFBB Pro">IFBB Pro</option>
                                <option value="メディア">メディア</option>
                                <option value="出展者">出展者</option>
                                <option value="招待">招待</option>
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit_ticket_count">合計付与枚数</label>
                            <input type="number" id="edit_ticket_count" name="ticket_count" min="0">
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="edit_is_pre_notified" name="is_pre_notified">
                                事前案内メール
                            </label>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="edit_is_checked_in" name="is_checked_in">
                                Check-In
                            </label>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="edit_is_post_mailed" name="is_post_mailed">
                                開催後メール
                            </label>
                        </div>
                        <div class="form-group full-width">
                            <label for="edit_note">備考欄（同伴者氏名など）</label>
                            <textarea id="edit_note" name="note" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancelEditBtn">キャンセル</button>
                    <button type="submit" class="btn-primary" id="saveEditBtn">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 削除確認ダイアログ -->
    <div id="deleteDialog" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>削除確認</h3>
                <button type="button" class="modal-close" id="closeDeleteDialog">&times;</button>
            </div>
            <div class="modal-body">
                <p>以下の関係者チケットを削除しますか？</p>
                <p class="delete-target-info">
                    <strong>代表者氏名:</strong> <span id="deleteTargetName"></span><br>
                    <strong>団体名:</strong> <span id="deleteTargetCompany"></span>
                </p>
                <p class="warning-text">この操作は取り消せません。</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelDeleteBtn">キャンセル</button>
                <button type="button" class="btn-danger" id="confirmDeleteBtn">削除</button>
            </div>
        </div>
    </div>

    <script src="guests-script.js"></script>
</body>
</html>
